{"version":3,"sources":["uni-app:///src/main.js","webpack:///./src/pages/TUI-Chat/chat.vue?1f1f","webpack:///./src/pages/TUI-Chat/chat.vue?49aa","webpack:///./src/pages/TUI-Chat/chat.vue?fa32","webpack:///./src/pages/TUI-Chat/chat.vue?2aa7","uni-app:///src/pages/TUI-Chat/chat.vue","webpack:///./src/pages/TUI-Chat/chat.vue?5d7b","webpack:///./src/pages/TUI-Chat/chat.vue?5dcb"],"names":["createPage","Page"],"mappings":"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","file":"pages/TUI-Chat/chat.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/TUI-Chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=5fe7757e&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/TUI-Chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=5fe7757e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"container\">\r\n    <!-- #ifdef MP-WEIXIN -->\r\n    <!-- <tuicalling\r\n\t\tref=\"TUICalling\"\r\n\t\tid=\"TUICalling-component\"\r\n\t\t:config=\"config\">\r\n\t</tuicalling> -->\r\n    <!-- #endif -->\r\n\r\n    <view class=\"group-profile\"\r\n      ><TUI-group-profile\r\n        v-if=\"isShow\"\r\n        id=\"groip-profile\"\r\n        :conversation=\"conversation\"\r\n    /></view>\r\n    <view class=\"message-list\" @tap=\"triggerClose\"\r\n      ><TUI-message-list\r\n        id=\"message-list\"\r\n        ref=\"messageList\"\r\n        :conversation=\"conversation\"\r\n    /></view>\r\n    <view v-if=\"videoPlay\" class=\"container-box\" @tap.stop=\"stopVideoHander\">\r\n      <video\r\n        v-if=\"videoPlay\"\r\n        class=\"video-message\"\r\n        :src=\"videoMessage.payload.videoUrl\"\r\n        :poster=\"videoMessage.payload.thumbUrl\"\r\n        object-fit=\"cover\"\r\n        error=\"videoError\"\r\n        autoplay=\"true\"\r\n        direction=\"0\"\r\n      />\r\n    </view>\r\n    <view v-if=\"showChat\" class=\"message-input\">\r\n      <TUI-message-input\r\n        id=\"message-input\"\r\n        ref=\"messageInput\"\r\n        :conversation=\"conversation\"\r\n        @sendMessage=\"sendMessage\"\r\n      />\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport logger from \"@/utils/logger\";\r\nimport TUIMessageList from \"../../components/tui-chat/message-list/index\";\r\nimport TUIMessageInput from \"../../components/tui-chat/message-input/index\";\r\nimport TUIGroupProfile from \"../../components/tui-group/group-profile/index\";\r\n\r\nimport { imTencentGetUserSig } from \"@/api/im\";\r\nimport TIM from \"tim-js-sdk\";\r\nimport TIMUploadPlugin from \"tim-upload-plugin\";\r\n\r\n// 初始化 SDK 实例\r\nconst tim = TIM.create({\r\n  SDKAppID: process.env.VUE_APP_SDK_APP_ID,\r\n});\r\ntim.setLogLevel(0);\r\n// 日志级别\r\n// tim.setLogLevel(GLOBAL_CONFIG.log_level)\r\n\r\n// 注册腾讯云即时通信 IM 上传插件\r\ntim.registerPlugin({ \"tim-upload-plugin\": TIMUploadPlugin });\r\n\r\nconst app = getApp();\r\nexport default {\r\n  components: {\r\n    TUIMessageList,\r\n    TUIMessageInput,\r\n    TUIGroupProfile,\r\n  },\r\n  props: {},\r\n  data() {\r\n    return {\r\n      conversationName: \"\",\r\n      conversation: {},\r\n      messageList: [],\r\n      isShow: false,\r\n      showChat: true,\r\n      conversationID: \"\",\r\n      videoPlay: false,\r\n      videoMessage: {},\r\n      config: {\r\n        sdkAppID: \"\",\r\n        userID: \"\",\r\n        userSig: \"\",\r\n        type: 1,\r\n        tim: null,\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    uni.$on(\"videoPlayerHandler\", (value) => {\r\n      this.videoPlay = value.isPlay;\r\n      this.videoMessage = value.message;\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  onLoad(options) {\r\n\tthis.conversationID = options.conversationID\r\n    setTimeout(() => {\r\n      this.getUserSig();\r\n    }, 1000);\r\n    // conversationID: C2C、 GROUP\r\n\r\n   \r\n  },\r\n  mounted() {},\r\n  onUnload() {\r\n    // #ifdef MP-WEIXIN\r\n    //   this.$refs.TUICalling.destroyed();\r\n    // // #endif\r\n  },\r\n  methods: {\r\n    getUserSig() {\r\n      imTencentGetUserSig({}).then((res) => {\r\n        if (res.code == \"0\") {\r\n          this.userSig = res.data.userSig;\r\n          this.userId = res.data.userId;\r\n          this.login();\r\n        }\r\n      });\r\n    },\r\n    login() {\r\n      let req = { userID: this.userId, userSig: this.userSig };\r\n\r\n      tim.login(req);\r\n\r\n\t  setTimeout(()=>{\r\n\t\t this.getDetails()\r\n\t  },1000)\r\n\t \r\n    },\r\n\tgetDetails(){\r\n\t\t const  conversationID  = this.conversationID;\r\n\t\t logger.log(\r\n      ` TUI-chat | onLoad | conversationID: ${conversationID}`\r\n    );\r\n   \r\n    this.setData({\r\n      conversationID,\r\n    });\r\n\r\n    tim.setMessageRead({ conversationID });\r\n\r\n    tim.getConversationProfile(conversationID).then((res) => {\r\n      const { conversation } = res.data;\r\n      this.conversation = conversation;\r\n      this.setData({\r\n        conversationName: this.getConversationName(conversation),\r\n        isShow: conversation.type === \"GROUP\",\r\n      });\r\n    });\r\n\t},\r\n    stopVideoHander() {\r\n      this.videoPlay = false;\r\n    },\r\n    getConversationName(conversation) {\r\n      if (conversation.type === \"@TIM#SYSTEM\") {\r\n        this.setData({\r\n          showChat: false,\r\n        });\r\n        return \"系统通知\";\r\n      }\r\n\r\n      if (conversation.type === \"C2C\") {\r\n        return (\r\n          conversation.remark ||\r\n          conversation.userProfile.nick ||\r\n          conversation.userProfile.userID\r\n        );\r\n      }\r\n\r\n      if (conversation.type === \"GROUP\") {\r\n        return (\r\n          conversation.groupProfile.name || conversation.groupProfile.groupID\r\n        );\r\n      }\r\n    },\r\n\r\n    sendMessage(event) {\r\n      // 将自己发送的消息写进消息列表里面\r\n      this.$refs.messageList.updateMessageList(event.detail.message);\r\n    },\r\n\r\n    triggerClose() {\r\n      if (this.showChat) {\r\n        this.$refs.messageInput.handleClose();\r\n      }\r\n    },\r\n\r\n    goBack() {\r\n      const pages = getCurrentPages(); // 当前页面栈\r\n\r\n      if (\r\n        pages[pages.length - 2].route ===\r\n          \"pages/TUI-Conversation/create-conversation/create\" ||\r\n        pages[pages.length - 2].route ===\r\n          \"pages/TUI-Group/create-group/create\" ||\r\n        pages[pages.length - 2].route === \"pages/TUI-Group/join-group/join\"\r\n      ) {\r\n        uni.navigateBack({\r\n          delta: 2,\r\n        });\r\n      } else {\r\n        uni.navigateBack({\r\n          delta: 1,\r\n        });\r\n      }\r\n\r\n      tim\r\n        .setMessageRead({\r\n          conversationID: this.conversationID,\r\n        })\r\n        .then(() => {});\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style>\r\n@import \"./chat.css\";\r\n</style>\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1672801256965\n      var cssReload = require(\"D:/ITG/Project/healthy-customer-app/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}