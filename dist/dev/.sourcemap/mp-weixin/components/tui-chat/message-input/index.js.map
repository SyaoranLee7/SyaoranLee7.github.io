{"version":3,"sources":["webpack:///./src/components/tui-chat/message-input/index.vue?9adb","webpack:///./src/components/tui-chat/message-input/index.vue?d7d3","webpack:///./src/components/tui-chat/message-input/index.vue?25c2","webpack:///./src/components/tui-chat/message-input/index.vue?b34b","uni-app:///src/components/tui-chat/message-input/index.vue","webpack:///./src/components/tui-chat/message-input/index.vue?f1f0","webpack:///./src/components/tui-chat/message-input/index.vue?af86"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AACsI;AACtI,gBAAgB,gJAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAid,CAAgB,8dAAG,EAAC,C;;;;;;;;;;;;;;;;;;;AC4Kre;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AADA;;AAGA,mB,CAEA;AACA;AACA;;AAEA;AAAA;AAAA;gBAEA;AACA,MADA,kBACA;AACA;AACA;AACA;AACA,4BAHA;AAIA,mBAJA;AAKA,0BALA;AAMA,2BANA;AAOA,qBAPA;AAQA,oBARA;AASA,kBATA;AAUA,mBAVA;AAWA,wBAXA;AAYA,wBAZA;AAaA,mBAbA;AAcA,kBAdA;AAeA,gBAfA;AAgBA,oBAhBA;AAiBA,kBAjBA;AAkBA,mBAlBA;AAmBA,uBAnBA;AAoBA,uBACA;AACA,mBADA;AAEA;AAFA,OADA,EAKA;AACA,oBADA;AAEA;AAFA,OALA,EASA;AACA,oBADA;AAEA;AAFA,OATA,CApBA;AAkCA,qCAlCA;AAmCA,+BAnCA;AAoCA;AApCA;AAsCA,GAxCA;AA0CA;AACA,sBADA;AAEA,kCAFA;AAGA,8BAHA;AAIA;AAJA,GA1CA;AAgDA;AACA;AACA,kBADA;AAEA;AAFA;AADA,GAhDA;AAsDA;AACA;AACA,yCACA;AACA;AACA;AACA;AACA,OANA;AAOA,qBAPA;AAQA;AARA;AADA,GAtDA;AAmEA,aAnEA,yBAmEA;AAAA;;AACA;AACA;AACA;AACA,uCADA,CAEA;AACA;;AACA;AACA,uEADA;AAEA,sCAFA;AAGA,iCACA,YADA,GAEA;AALA;AAOA,wBAXA,CAYA;;AACA;AACA;AACA;AACA,2BADA;AAEA;AAFA;AAIA,SALA,MAKA;AACA;AACA;AACA,oCADA;AAEA,qDAFA;AAGA;AACA;AADA;AAHA;;AAOA;AACA;AACA;;AAEA;AACA,qBADA;AAEA,0BAFA;AAGA,0BAHA;AAIA,qBAJA;AAKA,kBALA;AAMA;AANA;AAQA,KAxCA;AAyCA,GA/GA;AAiHA;AACA,eADA,yBACA;AACA;AACA,8BADA;AAEA;AAFA;AAIA,KANA;AAQA,mBARA,2BAQA,CARA,EAQA;AAAA;;AACA;AACA,uBADA;AAEA;AACA,yBAHA;AAIA;AACA,2BALA;AAMA;AACA,6BAPA;AAQA;AACA,qBATA,CASA;;AATA;AAWA;AACA,gCADA;AAEA,qBAFA;AAGA;AACA;AACA,qBALA;AAMA,qBANA;AAOA,yBAPA;AAQA,yBARA;AASA;AATA;AAWA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KAlCA;AAoCA;AACA,mBArCA,2BAqCA,CArCA,EAqCA;AACA;AACA,YACA,oEACA,GAFA,EAGA;AACA;AACA,wBADA;AAEA,8BAFA;AAGA;AAHA;AAKA,SATA,MASA,IACA,oEACA,EAFA,EAGA;AACA;AACA,wBADA;AAEA,0BAFA;AAGA;AAHA;AAKA,SATA,MASA;AACA;AACA,wBADA;AAEA,yBAFA;AAGA;AAHA;AAKA;AACA;AACA,KAjEA;AAmEA;AACA,kBApEA,4BAoEA;AACA;AACA,0BADA;AAEA;AAFA;AAIA;AACA;AACA,KA3EA;AA4EA,eA5EA,yBA4EA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AADA;AAGA,KAtFA;AAwFA,oBAxFA,8BAwFA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AADA;AAGA,KAlGA;AAoGA,SApGA,iBAoGA,CApGA,EAoGA;AACA;AACA,KAtGA;AAwGA,qBAxGA,+BAwGA;AACA;AACA,KA1GA;AA4GA,mBA5GA,6BA4GA;AACA;AACA,KA9GA;AAgHA,oBAhHA,4BAgHA,IAhHA,EAgHA;AAAA;;AACA;AACA,0BADA;AAEA,gBAFA;AAGA;AACA;AACA;AACA;AACA;AACA,uCADA;AAEA,gEAFA;AAGA;AACA;AADA;AAHA;;AAOA,4CAVA,CAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AA5BA;AA8BA,KA/IA;AAiJA,oBAjJA,8BAiJA;AACA;AACA,KAnJA;AAqJA,mBArJA,6BAqJA;AACA;AACA,KAvJA;AAyJA,oBAzJA,4BAyJA,IAzJA,EAyJA;AAAA;;AACA;AACA,0BADA;AAEA;AACA,uBAHA;AAIA;AACA,sBALA;AAMA;AACA;AACA;AACA;AACA,uCADA;AAEA,wDAFA;AAGA;AACA;AADA,eAHA;AAMA;AACA;AACA;AARA;;AAUA;AACA;AACA;AArBA;AAuBA,KAjLA;AAmLA,yBAnLA,iCAmLA,CAnLA,EAmLA;AACA;AACA;AACA;AACA;AADA;AAGA;;AAEA;AACA;AACA;AADA;AAGA;;AAEA;AACA;AACA;AADA;AAGA;;AAEA;AACA;AApBA;AAsBA,KA1MA;AA4MA,mBA5MA,6BA4MA;AACA;AACA;AADA;AAGA,KAhNA;AAkNA,iBAlNA,yBAkNA,CAlNA,EAkNA;AACA;AACA,oDADA;AAEA;AAFA;AAIA,KAvNA;AAyNA,gBAzNA,0BAyNA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AARA;AAUA,KAxOA;AAyOA,iBAzOA,yBAyOA,KAzOA,EAyOA;AACA;AACA;AACA;AACA,yBADA;AAEA;AAFA;AAIA;AACA;;AARA,UASA,MATA,GASA,6BATA,CASA,MATA;AAkCA;AACA,0BADA;AAEA;AAFA,SAlCA,CAsCA;AAEA,KAjRA;AAkRA,mBAlRA,2BAkRA,GAlRA,EAkRA,IAlRA,EAkRA;AACA;AACA;AACA;AACA,cADA;AAEA,gDAFA;AAGA;AACA;AADA;AAHA;AAOA;AACA,qBADA;AAEA;AAFA;AAIA;AACA,KAjSA;AAmSA,sBAnSA,8BAmSA,KAnSA,EAmSA;AACA;AACA;AACA;AADA;AAGA,OAJA,MAIA;AACA;AACA;AADA;AAGA;AACA,KA7SA;AA+SA,0BA/SA,kCA+SA,KA/SA,EA+SA;AACA;AACA;AACA;AADA;AAGA,KApTA;AAsTA,4BAtTA,oCAsTA,CAtTA,EAsTA;AACA;AACA,+BADA;AAEA,gDAFA;AAGA;AAHA;AAKA;AACA;AACA;AADA;AAGA,KAhUA;AAkUA,qBAlUA,6BAkUA,CAlUA,EAkUA;AACA;AACA;AACA;AACA;AADA;AAGA;;AAEA;AACA;AACA;AADA;AAGA;;AAEA;AACA;AACA;AADA;AAGA;;AAEA;AACA;AApBA;AAsBA,KAzVA;AA2VA,mBA3VA,2BA2VA,OA3VA,EA2VA;AAAA;;AACA;AACA;AACA;AACA;AADA;AADA;AAKA,UACA,WADA,CACA,OADA,EAEA,IAFA,CAEA;AACA,sCACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA,OAZA,EAaA,KAbA,CAaA,kBACA;AACA;AACA;AACA;AACA;AACA;AACA,OApBA;AAqBA;AACA;AADA;AAGA,KA1XA;AA4XA,eA5XA,yBA4XA;AACA;AACA;AADA;AAGA,KAhYA;AAkYA,2BAlYA,qCAkYA;AACA;AACA;AADA;AAGA,KAtYA;AAwYA,kBAxYA,4BAwYA;AACA;AACA,KA1YA;AA4YA,iBA5YA,2BA4YA;AACA;AACA;AA9YA;AAjHA,C;;;;;;;;;;;;;;AC3LA;AAAA;AAAA;AAAA;AAA0qB,CAAgB,ypBAAG,EAAC,C;;;;;;;;;;;ACA9rB;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/tui-chat/message-input/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=1da00aa0&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/tui-chat/message-input/index.vue\"\nexport default component.exports","export * from \"-!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=1da00aa0&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n    <view class=\"TUI-message-input-container\">\r\n      <!-- <view class=\"TUI-commom-function\">\r\n\t\t\t\t<view v-for=\"(item, index) in commonFunction\" :key=\"index\" class=\"TUI-commom-function-item\" :data-function=\"item\" @tap=\"handleCommonFunctions\">\r\n\t\t\t\t\t{{ item.name }}\r\n\t\t\t\t</view>\r\n\t\t\t</view> -->\r\n      <view class=\"TUI-message-input\">\r\n        <!-- <image class=\"TUI-icon\" @tap=\"switchAudio\" :src=\"isAudio ? '@/static/static/assets/keyboard.svg' : '@/static/static/assets/audio.svg'\"></image> -->\r\n\r\n        <!-- <image\r\n          class=\"TUI-icon\"\r\n          v-if=\"isAudio\"\r\n          @tap=\"switchAudio\"\r\n          src=\"@/static/static/assets/keyboard.svg\"\r\n        ></image>\r\n        <image\r\n          class=\"TUI-icon\"\r\n          v-if=\"!isAudio\"\r\n          @tap=\"switchAudio\"\r\n          src=\"@/static/static/assets/keyboard.svg\"\r\n        ></image> -->\r\n        <view v-if=\"!isAudio\" class=\"TUI-message-input-main\">\r\n          <input\r\n            class=\"TUI-message-input-area\"\r\n            :adjust-position=\"true\"\r\n            cursor-spacing=\"20\"\r\n            v-model=\"inputText\"\r\n            @input=\"onInputValueChange\"\r\n            maxlength=\"140\"\r\n            type=\"text\"\r\n            placeholder-class=\"input-placeholder\"\r\n            placeholder=\"说点什么呢~\"\r\n            @focus=\"inputBindFocus\"\r\n            @blur=\"inputBindBlur\"\r\n\t\t\tstyle=\"margin-left:20px\"\r\n          />\r\n        </view>\r\n        <view\r\n          v-else\r\n          class=\"TUI-message-input-main\"\r\n          @longpress=\"handleLongPress\"\r\n          @touchmove=\"handleTouchMove\"\r\n          @touchend=\"handleTouchEnd\"\r\n          style=\"\r\n            display: flex;\r\n            justify-content: center;\r\n            font-size: 32rpx;\r\n            font-family: PingFangSC-Regular;\r\n          \"\r\n        >\r\n          <text>{{ text }}</text>\r\n        </view>\r\n        <view class=\"TUI-message-input-functions\" hover-class=\"none\">\r\n          <image\r\n            class=\"TUI-icon\"\r\n            @tap=\"handleEmoji\"\r\n            src=\"@/static/static/assets/face-emoji.svg\"\r\n          ></image>\r\n          <view v-if=\"!sendMessageBtn\" @tap=\"handleExtensions\"\r\n            ><image\r\n              class=\"TUI-icon\"\r\n              src=\"@/static/static/assets/more.svg\"\r\n            ></image\r\n          ></view>\r\n          <view v-else class=\"TUI-sendMessage-btn\" @tap=\"sendTextMessage\"\r\n            >发送</view\r\n          >\r\n        </view>\r\n      </view>\r\n      <view v-if=\"displayFlag === 'emoji'\" class=\"TUI-Emoji-area\"\r\n        ><TUI-Emoji @enterEmoji=\"appendMessage\"></TUI-Emoji\r\n      ></view>\r\n      <view v-if=\"displayFlag === 'extension'\" class=\"TUI-Extensions\">\r\n        <!-- TODO: 这里功能还没实现 -->\r\n        <!--        <camera device-position=\"back\" flash=\"off\" binderror=\"error\" style=\"width: 100%; height: 300px;\"></camera>-->\r\n        <view class=\"TUI-Extension-slot\" @tap=\"handleSendPicture\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/take-photo.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">拍摄照片</view>\r\n        </view>\r\n        <view class=\"TUI-Extension-slot\" @tap=\"handleSendImage\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/send-img.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">发送图片</view>\r\n        </view>\r\n        <view class=\"TUI-Extension-slot\" @tap=\"handleShootVideo\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/take-video.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">拍摄视频</view>\r\n        </view>\r\n        <view class=\"TUI-Extension-slot\" @tap=\"handleSendVideo\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/send-video.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">发送视频</view>\r\n        </view>\r\n        <!-- <view class=\"TUI-Extension-slot\" @tap=\"handleCalling(1)\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/audio-calling.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">语音通话</view>\r\n        </view>\r\n        <view class=\"TUI-Extension-slot\" @tap=\"handleCalling(2)\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/video-calling.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">视频通话</view>\r\n        </view> -->\r\n        <view class=\"TUI-Extension-slot\" @tap=\"handleServiceEvaluation\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/service-assess.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">服务评价</view>\r\n        </view>\r\n        <!-- <view class=\"TUI-Extension-slot\" @tap=\"handleSendOrder\">\r\n          <image\r\n            class=\"TUI-Extension-icon\"\r\n            src=\"@/static/static/assets/send-order.svg\"\r\n          ></image>\r\n          <view class=\"TUI-Extension-slot-name\">发送订单</view>\r\n        </view> -->\r\n      </view>\r\n      <TUI-Common-Words\r\n        class=\"tui-cards\"\r\n        :display=\"displayCommonWords\"\r\n        @sendMessage=\"$handleSendTextMessage\"\r\n        @close=\"$handleCloseCards\"\r\n      ></TUI-Common-Words>\r\n      <TUI-Order-List\r\n        class=\"tui-cards\"\r\n        :display=\"displayOrderList\"\r\n        @sendCustomMessage=\"$handleSendCustomMessage\"\r\n        @close=\"$handleCloseCards\"\r\n      ></TUI-Order-List>\r\n      <TUI-Service-Evaluation\r\n        class=\"tui-cards\"\r\n        :display=\"displayServiceEvaluation\"\r\n        @sendCustomMessage=\"$handleSendCustomMessage\"\r\n        @close=\"$handleCloseCards\"\r\n      ></TUI-Service-Evaluation>\r\n    </view>\r\n    <view\r\n      class=\"record-modal\"\r\n      v-if=\"popupToggle\"\r\n      @longpress=\"handleLongPress\"\r\n      @touchmove=\"handleTouchMove\"\r\n      @touchend=\"handleTouchEnd\"\r\n    >\r\n      <view class=\"wrapper\"><view class=\"modal-loading\"></view></view>\r\n      <view class=\"modal-title\">{{ title }}</view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport TUIEmoji from \"../message-elements/emoji/index\";\r\nimport TUICommonWords from \"../message-private/common-words/index\";\r\nimport TUIOrderList from \"../message-private/order-list/index\";\r\nimport TUIServiceEvaluation from \"../message-private/service-evaluation/index\";\r\n\r\nimport TIM from \"tim-js-sdk\";\r\nimport TIMUploadPlugin from \"tim-upload-plugin\";\r\n\r\n// 初始化 SDK 实例\r\nconst tim = TIM.create({\r\n  SDKAppID: process.env.VUE_APP_SDK_APP_ID,\r\n});\r\ntim.setLogLevel(0);\r\n\r\n// 日志级别\r\n// tim.setLogLevel(GLOBAL_CONFIG.log_level)\r\n// 注册腾讯云即时通信 IM 上传插件\r\n\r\ntim.registerPlugin({ \"tim-upload-plugin\": TIMUploadPlugin });\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      // todo  conversation\r\n      // conversation: {},\r\n      firstSendMessage: true,\r\n      inputText: \"\",\r\n      extensionArea: false,\r\n      sendMessageBtn: false,\r\n      displayFlag: \"\",\r\n      isAudio: false,\r\n      bottomVal: 0,\r\n      startPoint: 0,\r\n      popupToggle: false,\r\n      isRecording: false,\r\n      canSend: true,\r\n      text: \"按住说话\",\r\n      title: \" \",\r\n      notShow: false,\r\n      isShow: true,\r\n      recordTime: 0,\r\n      recordTimer: null,\r\n      commonFunction: [\r\n        {\r\n          name: \"常用语\",\r\n          key: \"0\",\r\n        },\r\n        {\r\n          name: \"发送订单\",\r\n          key: \"1\",\r\n        },\r\n        {\r\n          name: \"服务评价\",\r\n          key: \"2\",\r\n        },\r\n      ],\r\n      displayServiceEvaluation: false,\r\n      displayCommonWords: false,\r\n      displayOrderList: false,\r\n    };\r\n  },\r\n\r\n  components: {\r\n    TUIEmoji,\r\n    TUICommonWords,\r\n    TUIOrderList,\r\n    TUIServiceEvaluation,\r\n  },\r\n  props: {\r\n    conversation: {\r\n      type: Object,\r\n      default: () => {},\r\n    },\r\n  },\r\n  watch: {\r\n    conversation: {\r\n      handler: function (newVal) {\r\n        // todo 值会被改变\r\n        // this.setData({\r\n        //   conversation: newVal\r\n        // });\r\n      },\r\n      immediate: true,\r\n      deep: true,\r\n    },\r\n  },\r\n\r\n  beforeMount() {\r\n    // 加载声音录制管理器\r\n    this.recorderManager = uni.getRecorderManager();\r\n    this.recorderManager.onStop((res) => {\r\n      clearInterval(this.recordTimer);\r\n      // 兼容 uniapp 打包app，duration 和 fileSize 需要用户自己补充\r\n      // 文件大小 ＝ (音频码率) x 时间长度(单位:秒) / 8\r\n      let msg = {\r\n        duration: res.duration ? res.duration : this.recordTime * 1000,\r\n        tempFilePath: res.tempFilePath,\r\n        fileSize: res.fileSize\r\n          ? res.fileSize\r\n          : ((48 * this.recordTime) / 8) * 1024,\r\n      };\r\n      uni.hideLoading();\r\n      // 兼容 uniapp 语音消息没有duration\r\n      if (this.canSend) {\r\n        if (msg.duration < 1000) {\r\n          uni.showToast({\r\n            title: \"录音时间太短\",\r\n            icon: \"none\",\r\n          });\r\n        } else {\r\n          // res.tempFilePath 存储录音文件的临时路径\r\n          const message = tim.createAudioMessage({\r\n            to: this.getToAccount(),\r\n            conversationType: this.conversation.type,\r\n            payload: {\r\n              file: msg,\r\n            },\r\n          });\r\n          this.$sendTIMMessage(message);\r\n        }\r\n      }\r\n\r\n      this.setData({\r\n        startPoint: 0,\r\n        popupToggle: false,\r\n        isRecording: false,\r\n        canSend: true,\r\n        title: \" \",\r\n        text: \"按住说话\",\r\n      });\r\n    });\r\n  },\r\n\r\n  methods: {\r\n    switchAudio() {\r\n      this.setData({\r\n        isAudio: !this.isAudio,\r\n        text: \"按住说话\",\r\n      });\r\n    },\r\n\r\n    handleLongPress(e) {\r\n      this.recorderManager.start({\r\n        duration: 60000,\r\n        // 录音的时长，单位 ms，最大值 600000（10 分钟）\r\n        sampleRate: 44100,\r\n        // 采样率\r\n        numberOfChannels: 1,\r\n        // 录音通道数\r\n        encodeBitRate: 192000,\r\n        // 编码码率\r\n        format: \"aac\", // 音频格式，选择此格式创建的音频消息，可以在即时通信 IM 全平台（Android、iOS、微信小程序和Web）互通\r\n      });\r\n      this.setData({\r\n        startPoint: e.touches[0],\r\n        title: \"正在录音\",\r\n        // isRecording : true,\r\n        // canSend: true,\r\n        notShow: true,\r\n        isShow: false,\r\n        isRecording: true,\r\n        popupToggle: true,\r\n        recordTime: 0,\r\n      });\r\n      this.recordTimer = setInterval(() => {\r\n        this.recordTime++;\r\n      }, 1000);\r\n    },\r\n\r\n    // 录音时的手势上划移动距离对应文案变化\r\n    handleTouchMove(e) {\r\n      if (this.isRecording) {\r\n        if (\r\n          this.startPoint.clientY - e.touches[e.touches.length - 1].clientY >\r\n          100\r\n        ) {\r\n          this.setData({\r\n            text: \"抬起停止\",\r\n            title: \"松开手指，取消发送\",\r\n            canSend: false,\r\n          });\r\n        } else if (\r\n          this.startPoint.clientY - e.touches[e.touches.length - 1].clientY >\r\n          20\r\n        ) {\r\n          this.setData({\r\n            text: \"抬起停止\",\r\n            title: \"上划可取消\",\r\n            canSend: true,\r\n          });\r\n        } else {\r\n          this.setData({\r\n            text: \"抬起停止\",\r\n            title: \"正在录音\",\r\n            canSend: true,\r\n          });\r\n        }\r\n      }\r\n    },\r\n\r\n    // 手指离开页面滑动\r\n    handleTouchEnd() {\r\n      this.setData({\r\n        isRecording: false,\r\n        popupToggle: false,\r\n      });\r\n      uni.hideLoading();\r\n      this.recorderManager.stop();\r\n    },\r\n    handleEmoji() {\r\n      let targetFlag = \"emoji\";\r\n\r\n      if (this.displayFlag === \"emoji\") {\r\n        targetFlag = \"\";\r\n      }\r\n\r\n      this.setData({\r\n        displayFlag: targetFlag,\r\n      });\r\n    },\r\n\r\n    handleExtensions() {\r\n      let targetFlag = \"extension\";\r\n\r\n      if (this.displayFlag === \"extension\") {\r\n        targetFlag = \"\";\r\n      }\r\n\r\n      this.setData({\r\n        displayFlag: targetFlag,\r\n      });\r\n    },\r\n\r\n    error(e) {\r\n      console.log(e.detail);\r\n    },\r\n\r\n    handleSendPicture() {\r\n      this.sendImageMessage(\"camera\");\r\n    },\r\n\r\n    handleSendImage() {\r\n      this.sendImageMessage(\"album\");\r\n    },\r\n\r\n    sendImageMessage(type) {\r\n      uni.chooseImage({\r\n        sourceType: [type],\r\n        count: 1,\r\n        success: (res) => {\r\n          if (res) {\r\n            // alert(this.getToAccount())\r\n            // alert(JSON.stringify(res));\r\n            let message = tim.createImageMessage({\r\n              to: this.getToAccount(),\r\n              conversationType: TIM.TYPES.CONV_C2C,\r\n              payload: {\r\n                file: res,\r\n              },\r\n            });\r\n            this.$sendTIMMessage(message);\r\n\r\n            // const message = tim.createImageMessage({\r\n            // \tto: this.getToAccount(),\r\n            // \tconversationType: this.conversation.type,\r\n            // \tpayload: {\r\n            // \t\tfile: res\r\n            // \t},\r\n            // \tonProgress: percent => {\r\n            // \t\tmessage.percent = percent;\r\n            // \t}\r\n            // });\r\n            // this.$sendTIMMessage(message);\r\n          }\r\n        },\r\n      });\r\n    },\r\n\r\n    handleShootVideo() {\r\n      this.sendVideoMessage(\"camera\");\r\n    },\r\n\r\n    handleSendVideo() {\r\n      this.sendVideoMessage(\"album\");\r\n    },\r\n\r\n    sendVideoMessage(type) {\r\n      uni.chooseVideo({\r\n        sourceType: [type],\r\n        // 来源相册或者拍摄\r\n        maxDuration: 60,\r\n        // 设置最长时间60s\r\n        camera: \"back\",\r\n        // 后置摄像头\r\n        success: (res) => {\r\n          if (res) {\r\n            const message = tim.createVideoMessage({\r\n              to: this.getToAccount(),\r\n              conversationType: this.conversation.type,\r\n              payload: {\r\n                file: res,\r\n              },\r\n              onProgress: (percent) => {\r\n                message.percent = percent;\r\n              },\r\n            });\r\n            this.$sendTIMMessage(message);\r\n          }\r\n        },\r\n      });\r\n    },\r\n\r\n    handleCommonFunctions(e) {\r\n      switch (e.target.dataset.function.key) {\r\n        case \"0\":\r\n          this.setData({\r\n            displayCommonWords: true,\r\n          });\r\n          break;\r\n\r\n        case \"1\":\r\n          this.setData({\r\n            displayOrderList: true,\r\n          });\r\n          break;\r\n\r\n        case \"2\":\r\n          this.setData({\r\n            displayServiceEvaluation: true,\r\n          });\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n\r\n    handleSendOrder() {\r\n      this.setData({\r\n        displayOrderList: true,\r\n      });\r\n    },\r\n\r\n    appendMessage(e) {\r\n      this.setData({\r\n        inputText: this.inputText + e.detail.message,\r\n        sendMessageBtn: true,\r\n      });\r\n    },\r\n\r\n    getToAccount() {\r\n      if (!this.conversation || !this.conversation.conversationID) {\r\n        return \"\";\r\n      }\r\n\r\n      switch (this.conversation.type) {\r\n        case \"C2C\":\r\n          return this.conversation.conversationID.replace(\"C2C\", \"\");\r\n\r\n        case \"GROUP\":\r\n          return this.conversation.conversationID.replace(\"GROUP\", \"\");\r\n\r\n        default:\r\n          return this.conversation.conversationID;\r\n      }\r\n    },\r\n    handleCalling(value) {\r\n      // todo 目前支持单聊\r\n      if (this.conversation.type === \"GROUP\") {\r\n        uni.showToast({\r\n          title: \"群聊暂不支持\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n      const { userID } = this.conversation.userProfile;\r\n\r\n      // #ifdef APP-PLUS\r\n      if (typeof uni.$TUICalling === \"undefined\") {\r\n        logger.error(\r\n          \"请使用真机运行并且自定义基座调试，可能影响音视频功能～ 插件地址：https://ext.dcloud.net.cn/plugin?id=7097 , 调试地址：https://nativesupport.dcloud.net.cn/NativePlugin/use/use\"\r\n        );\r\n        uni.showToast({\r\n          title: \"请使用真机运行并且自定义基座调试，可能影响音视频功能～ \",\r\n          icon: \"none\",\r\n          duration: 3000,\r\n        });\r\n      } else {\r\n        uni.$TUICalling.call(\r\n          {\r\n            userID: userID,\r\n            type: value,\r\n          },\r\n          (res) => {\r\n            console.log(JSON.stringify(res));\r\n          }\r\n        );\r\n      }\r\n      // #endif\r\n      // #ifdef MP-WEIXIN\r\n      uni.showToast({\r\n        title: \"微信小程序暂不支持\",\r\n        icon: \"none\",\r\n      });\r\n      // uni.$wxTUICalling.call({userID, type: value})\r\n      // #endif\r\n    },\r\n    sendTextMessage(msg, flag) {\r\n      const to = this.getToAccount();\r\n      const text = flag ? msg : this.inputText;\r\n      const message = tim.createTextMessage({\r\n        to,\r\n        conversationType: this.conversation.type,\r\n        payload: {\r\n          text,\r\n        },\r\n      });\r\n      this.setData({\r\n        inputText: \"\",\r\n        sendMessageBtn: false,\r\n      });\r\n      this.$sendTIMMessage(message);\r\n    },\r\n\r\n    onInputValueChange(event) {\r\n      if (event.detail.value) {\r\n        this.setData({\r\n          sendMessageBtn: true,\r\n        });\r\n      } else {\r\n        this.setData({\r\n          sendMessageBtn: false,\r\n        });\r\n      }\r\n    },\r\n\r\n    $handleSendTextMessage(event) {\r\n      this.sendTextMessage(event.detail.message, true);\r\n      this.setData({\r\n        displayCommonWords: false,\r\n      });\r\n    },\r\n\r\n    $handleSendCustomMessage(e) {\r\n      const message = tim.createCustomMessage({\r\n        to: this.getToAccount(),\r\n        conversationType: this.conversation.type,\r\n        payload: e.detail.payload,\r\n      });\r\n      this.$sendTIMMessage(message);\r\n      this.setData({\r\n        displayOrderList: false,\r\n      });\r\n    },\r\n\r\n    $handleCloseCards(e) {\r\n      switch (e.detail.key) {\r\n        case \"0\":\r\n          this.setData({\r\n            displayCommonWords: false,\r\n          });\r\n          break;\r\n\r\n        case \"1\":\r\n          this.setData({\r\n            displayOrderList: false,\r\n          });\r\n          break;\r\n\r\n        case \"2\":\r\n          this.setData({\r\n            displayServiceEvaluation: false,\r\n          });\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n\r\n    $sendTIMMessage(message) {\r\n      const SDKAppID = getApp().globalData.SDKAppID;\r\n      this.$emit(\"sendMessage\", {\r\n        detail: {\r\n          message,\r\n        },\r\n      });\r\n      tim\r\n        .sendMessage(message)\r\n        .then((res) => {\r\n          if (this.firstSendMessage) {\r\n            // uni.$aegis.reportEvent({\r\n            //   name: \"sendMessage\",\r\n            //   ext1: \"sendMessage-success\",\r\n            //   ext2: \"uniTuikitExternal\",\r\n            //   ext3: `${SDKAppID}`,\r\n            // });\r\n          }\r\n          this.firstSendMessage = false;\r\n        })\r\n        .catch((error) => {\r\n          //   uni.$aegis.reportEvent({\r\n          //     name: \"sendMessage\",\r\n          //     ext1: `sendMessage-failed#error: ${error}`,\r\n          //     ext2: \"uniTuikitExternal\",\r\n          //     ext3: `${SDKAppID}`,\r\n          //   });\r\n        });\r\n      this.setData({\r\n        displayFlag: \"\",\r\n      });\r\n    },\r\n\r\n    handleClose() {\r\n      this.setData({\r\n        displayFlag: \"\",\r\n      });\r\n    },\r\n\r\n    handleServiceEvaluation() {\r\n      this.setData({\r\n        displayServiceEvaluation: true,\r\n      });\r\n    },\r\n\r\n    inputBindFocus() {\r\n      console.log(\"占位：函数 inputBindFocus 未声明\");\r\n    },\r\n\r\n    inputBindBlur() {\r\n      console.log(\"占位：函数 inputBindBlur 未声明\");\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style>\r\n@import \"./index.css\";\r\n</style>\r\n","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1672801258371\n      var cssReload = require(\"D:/ITG/Project/healthy-customer-app/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}